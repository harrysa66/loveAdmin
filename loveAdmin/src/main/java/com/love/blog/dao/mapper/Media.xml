<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Media">
	<sql id="sqlList" >
    	o.id,o.parent_id, o.type_id, o.name, o.file_id, o.create_time, o.modify_time, o.`status`, o.isValid
  	</sql>

  	<insert id="insert" parameterType="media" >
    insert into love_blog_media (id,parent_id, type_id, name, 
      file_id, create_time, 
      modify_time, `status`, isvalid)
    values (#{id,jdbcType=VARCHAR},#{parentId,jdbcType=VARCHAR}, #{typeId,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{fileId,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},#{modifyTime,jdbcType=TIMESTAMP}, 
      #{status,jdbcType=VARCHAR}, #{isvalid,jdbcType=VARCHAR})
  </insert>
  
  <update id="update" parameterType="media" >
    update love_blog_media
    <set >
    	<if test="parentId != null" >
        parent_id = #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="typeId != null" >
        type_id = #{typeId,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="fileId != null" >
        file_id = #{fileId,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null" >
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        `status` = #{status,jdbcType=VARCHAR},
      </if>
      <if test="isvalid != null" >
        isValid = #{isvalid,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 分页查询 -->
	<select id="queryPage" parameterType="map" resultType="media">
		select distinct <include refid="sqlList" /> ,t.name as typeName,f.upload_user_name as nickname
		FROM love_blog_media o left join love_blog_media_type t on o.type_id = t.id 
		left join love_system_file f on o.user_id = f.upload_user_id
		WHERE o.STATUS !='DELETED'
		 	<if test="name !=null and name != ''"> 
              and  o.name like '%${name}%'
            </if> 
            <if test="typeId !=null and typeId != ''"> 
              and  o.type_id = #{typeId}
            </if>
            <if test="nickname !=null and nickname != ''"> 
              and  f.upload_user_name = #{nickname}
            </if>
            <if test="isvalid !=null and isvalid != ''"> 
              and  o.isvalid = #{isvalid}
            </if>
            order by o.create_time
       
	</select>
	
	<!-- 统计分页查询的数据条数 -->
	<select id="queryPageCount" parameterType="map" resultType="int">
		select count(distinct o.id)
		FROM love_blog_media o left join love_blog_media_type t on o.type_id = t.id 
		left join love_system_file f on o.user_id = f.upload_user_id
		WHERE o.STATUS !='DELETED'
		 	<if test="name !=null and name != ''"> 
              and  o.name like '%${name}%'
            </if> 
            <if test="typeId !=null and typeId != ''"> 
              and  o.type_id = #{typeId}
            </if>
            <if test="nickname !=null and nickname != ''"> 
              and  f.upload_user_name = #{nickname}
            </if>
            <if test="isvalid !=null and isvalid != ''"> 
              and  o.isvalid = #{isvalid}
            </if>
	</select>
	
	<!-- 通过ID查找 -->
	<select id="selectById" parameterType="String" resultType="media">
		select <include refid="sqlList" />
		FROM love_blog_media o
		WHERE o.id=#{id} and o.STATUS !='DELETED'
	</select>
	
	<!-- 通过类型查找 -->
	<select id="findListByType" parameterType="map" resultType="media">
		select <include refid="sqlList" />
		FROM love_blog_media o
		WHERE o.type_id=#{typeId} and o.STATUS !='DELETED'
		<if test="status !=null and status != ''">
			and o.STATUS=#{status}
		</if>
	</select>
	
	<!-- 逻辑删除 -->
	<update id="deleteById" parameterType="map">
		update love_blog_media set STATUS=#{status} where ID=#{id}
	</update>
	
	<!-- 启用/禁用 -->
	<update id="runById" parameterType="map">
		update love_blog_media set ISVALID=#{isvalid} where ID=#{id}
	</update>
	
</mapper>